<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Silindir ve Cubuk Oyunu</title>
    <style>
        body { margin: 0; overflow: hidden; background: #2c3e50; font-family: sans-serif; }
        canvas { display: block; background: #87CEEB; }
        #ui { position: absolute; top: 10px; width: 100%; text-align: center; pointer-events: none; color: white; }
    </style>
</head>
<body>

<div id="ui">
    <h1 id="lvl">Seviye: 1</h1>
    <p id="msg">Silindirlere doğru sırayla bas!</p>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const imgSilindir = new Image();
const imgCubuk = new Image();
imgSilindir.src = 'Silindir.png';
imgCubuk.src = 'Cubuk.png';

let level = 1;
let cylinders = [];
let correctSeq = [];
let playerIdx = 0;
let isLocked = false;

// Boyut Ayarları
const cylW = 100; 
const cylH = 80;  
const poleW = 40; 

function init() {
    cylinders = [];
    playerIdx = 0;
    isLocked = false;
    const adet = level + 2;
    
    // Doğru sıralama
    correctSeq = Array.from({length: adet}, (_, i) => i);
    correctSeq.sort(() => Math.random() - 0.5);

    const bosluk = canvas.width / (adet + 1);
    for (let i = 0; i < adet; i++) {
        cylinders.push({
            id: i,
            x: bosluk * (i + 1) - cylW / 2,
            // Silindirler artık biraz daha yukarıda (ekranın ortasına yakın) başlıyor
            baseY: canvas.height - 300, 
            up: false,
            animY: canvas.height - 300
        });
    }
    document.getElementById('lvl').innerText = "Seviye: " + level;
    document.getElementById('msg').innerText = "Doğru sırayı bul!";
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    cylinders.forEach(c => {
        // Hareket animasyonu
        // Seçilince daha da yukarı (baseY - 200) çıkar
        let hedef = c.up ? c.baseY - 200 : c.baseY;
        c.animY += (hedef - c.animY) * 0.1;

        // 1. ÇUBUĞU ÇİZ (Tüm kısmı görünmesi için silindirden ekranın altına kadar)
        const poleX = c.x + (cylW / 2) - (poleW / 2);
        const poleStartTop = c.animY + (cylH / 2); // Silindirin ortasından başlar
        const poleHeight = canvas.height - poleStartTop; // Ekranın en altına kadar uzanır

        if (imgCubuk.complete && imgCubuk.naturalWidth > 0) {
            ctx.drawImage(imgCubuk, poleX, poleStartTop, poleW, poleHeight);
        } else {
            ctx.fillStyle = "#95a5a6";
            ctx.fillRect(poleX, poleStartTop, poleW, poleHeight);
        }

        // 2. SİLİNDİRİ ÇİZ
        if (imgSilindir.complete && imgSilindir.naturalWidth > 0) {
            ctx.drawImage(imgSilindir, c.x, c.animY, cylW, cylH);
        } else {
            ctx.fillStyle = "#d35400";
            ctx.fillRect(c.x, c.animY, cylW, cylH);
        }
    });

    requestAnimationFrame(draw);
}

canvas.addEventListener('mousedown', (e) => {
    if (isLocked) return;

    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    cylinders.forEach(c => {
        if (mx > c.x && mx < c.x + cylW && my > c.animY && my < c.animY + cylH && !c.up) {
            if (c.id === correctSeq[playerIdx]) {
                c.up = true;
                playerIdx++;
                
                if (playerIdx === cylinders.length) {
                    isLocked = true;
                    document.getElementById('msg').innerText = "TEBRİKLER!";
                    setTimeout(() => {
                        level++;
                        init();
                    }, 1200);
                }
            } else {
                isLocked = true;
                c.up = true;
                document.getElementById('msg').innerText = "YANLIŞ! TEKRAR DENE...";
                
                setTimeout(() => {
                    // Yanlışta aynı seviyeden devam etmek için sadece durumları sıfırla
                    cylinders.forEach(cyl => cyl.up = false);
                    playerIdx = 0;
                    isLocked = false;
                }, 1000);
            }
        }
    });
});

window.onresize = () => { 
    canvas.width = window.innerWidth; 
    canvas.height = window.innerHeight; 
    init(); 
};

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
init();
draw();
</script>
</body>
</html>
